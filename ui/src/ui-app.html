<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./redux-behavior.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="./app-styles.html">
<link rel="import" href="./bump-appheader.html">
<link rel="import" href="./auth/auth-container.html">
<link rel="import" href="./bump/bumps-container.html">
<link rel="import" href="./auth/signout-page.html">
<link rel="import" href="./solvers/solvers-container.html">

<dom-module id="ui-app">
  <template>
    <bump-appheader id="bumpAppHeader"
      is-pending="[[isPending]]"
      is-signed-in="[[isSignedIn]]"
      is-signed-out="[[isSignedOut]]"
      app-title="[[appTitle]]";
    ></bump-appheader>
    <!-- Top Level Paging -->
    <iron-pages 
      id="pageSelector" 
      attr-for-selected="id" 
      selected="[[displayPage]]" 
      fallback-selection="pathWarning">
       <bumps-container id="bumpsContainer"></bumps-container>
       <auth-container id="authContainer"></auth-container>
       <signout-page id="signOutPage"></signout-page>
       <solvers-container id="solversContainer"></solvers-container>
       <p id="pathWarning">Sorry. We can't find that page. :-(</p>
    </iron-pages>
  </template>
  <script>
    Polymer({
      is: 'ui-app',
      behaviors: [ReduxBehavior],
      // Redux Actions
      actions: {
         signOut: app.auth.signOut,
      },
      properties: {
        appTitle: {
          type: String,
          value: document.title,
        },
        displayPage: {
          type: String,
          value: "bumpsContainer",
        },
        isSignedIn: {
          type: Boolean,
          statePath: app.auth.isSignedIn,
          observer: "_isSignedIn",
        },
        isSignedOut: {
          type: Boolean,
          statePath: app.auth.isSignedOut,
        },
        isPending: {
          type: Boolean,
          statePath: app.auth.isPending,
        },
       },
      //Event listeners
      listeners: {
        'request-menu':"_displayMenu", //from bump-appheader
        'request-signin': "_signIn", //from bump-appheader
        'request-signout': "_signOut", //from bump-appheader
        'signout-confirmed' : '_signOutConfirmed', //from sign-out
        'signout-cancelled' : '_signOutCancelled', //from sign-out
        'request-view-solvers' : '_viewSolvers', //from bump-appheader
        'request-view-bumps' : '_viewBumps', //from bump-appheader
      },
      //listener handlers
      _displayMenu: function () {
       //TO BE IMPLEMENTED. For now we will return to the main bumps page.
        console.log("ui-app: _displayMenu");
        console.log(document.title);
        this.displayPage="bumpsContainer";
      },   
      _signIn: function(){
        console.log("ui-app: _signIn (changing page)");
        this.displayPage= "authContainer";
      },
      _signOut: function() {
        console.log("ui-app: _signOut(changing page)");
        this.displayPage="signOutPage";
      },
      _signOutConfirmed: function() {
        console.log("ui-app: _signOut (changing page)");
        this.displayPage="bumpsContainer";
        return this.dispatch('signOut');
      },
      _signOutCancelled: function () {
        console.log("ui-app: _signOutCancelled (changing page)");
        this.displayPage="bumpsContainer";
      },
      //Property Observers
      _isSignedIn: function () {
          if(this.isSignedIn) {
            console.log("ui-app: IsSignedIn= " + this.isSignedIn)
            this.displayPage="bumpsContainer";
          }
      },
      _viewSolvers: function () {
        console.log("ui-app: _viewSolvers");
        this.displayPage = "solversContainer";
      },
      _viewBumps: function () {
        console.log("ui-app: _viewBumps");
        this.displayPage = "bumpsContainer";
      },
    });
  </script>
</dom-module>
