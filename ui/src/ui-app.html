<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./app-styles.html">
<link rel="import" href="./redux-behavior.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-label/iron-label.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="./auth/auth-container.html">
<link rel="import" href="./bumps/bumps-container.html">
<link rel="import" href="./auth/signout-page.html">
<link rel="import" href="./solvers/solvers-container.html">
<link rel="import" href="./solutions/solutions-container.html">

<dom-module id="ui-app">
  <template>
    <style include="app-styles">
      #appHeader {
        background-color : var(--default-primary-color);
        color: var(--text-primary-color);
      }
      .activeLabel:hover { 
        color: var(--accent-color);
        cursor: pointer;
      }
      app-drawer {
        --app-drawer-content-container: {
        background-color: var(--primary-background-color);
        overflow-x: hidden;
       };
      }
      .drawer-list {
        margin: 0 20px;
      }
      .drawer-list a {
        display: block;
        padding: 0 2px;
        text-decoration: none;
        color: var(--primary-text-color);
        line-height: 40px;
      }
      .drawer-list .menu-icon-item:hover {
        color: var(--primary-text-color);
        background-color: var(--accent-color);
      }
      paper-tabs {
        --paper-tabs-selection-bar-color: var(--accent-color);
      }
      paper-tab {
        margin-left: 20px;
        margin-right: 10px;
      }
      .link {
        @apply --layout-horizontal;
        @apply --layout-center-center;
      }
      .tab-item-container {
        text-align: center;
      }
      #username {
        text-align: center;       
      }
      /* small screen */
      @media (max-width: 499px) {
        #appTitle {
          display: none;
        }
        #authicons {
          display: none;
        }
      }
      paper-spinner-lite.white {
        --paper-spinner-color: white;
      }
      #signInIcon {
        --iron-icon-fill-color: red;
        --iron-icon-height: 32px;
        --iron-icon-width: 32px;
      }
      #signOutIcon {
        --iron-icon-fill-color: green;  
        --iron-icon-height: 32px;
        --iron-icon-width: 32px;   
      }
    </style>
    <app-location id="location" route="{{route}}"></app-location>
    <app-route
      id="route"
      route="{{route}}"
      pattern="/:page"
      data="{{routeData}}"
      tail="{{subRoute}}"
    ></app-route>

    <app-drawer-layout id="drawerLayout" fullbleed>
     <!-- Drawer content -->
      <app-drawer id="drawer" opened="false">
        <app-toolbar id="side-toolbar">
           <h4>[[appTitle]]</h4>
        </app-toolbar>
        <hr>
        <iron-selector 
          id="menudrawer"
          selected="[[routeData.page]]" 
          attr-for-selected="id" 
          class="drawer-list" 
          role="navigation" 
          on-iron-activate="_drawerSelected">
          <template is="dom-if" if="[[isSignedIn]]">
          <paper-icon-item class="menu-icon-item">
            <iron-icon class="menu-icons" icon="icons:settings" item-icon></iron-icon>
            <a id="profile" href="/auth/profile">[[displayName]]</a>
          </paper-icon-item>
          </template>
          <paper-icon-item class="menu-icon-item">
            <iron-icon class="menu-icons" icon="maps:terrain" item-icon></iron-icon>
            <a id="bumps" href="/bumps/add">Add-Bumps</a>
          </paper-icon-item>
          <paper-icon-item class="menu-icon-item">
            <iron-icon class="menu-icons" icon="maps:near-me" item-icon></iron-icon>
            <a id="solutions" href="/solutions/add">Add-Solutions</a>
          </paper-icon-item>
          <paper-icon-item class="menu-icon-item">
            <iron-icon class="menu-icons" icon="icons:stars" item-icon></iron-icon>
            <a id="solutions" href="/solvers/add">Add-Solvers</a>
          </paper-icon-item>
          <paper-icon-item class="menu-icon-item">
            <iron-icon class="menu-icons" icon="icons:announcement" item-icon></iron-icon>
            <a id="faqs" href="/feedback">FAQs</a>
          </paper-icon-item>
          <paper-icon-item class="menu-icon-item" hidden$="[[isSignedOut]]">
            <iron-icon class="menu-icons" icon="icons:account-circle" item-icon></iron-icon>
            <a id="signout" href="/signout">Sign-Out</a>
          </paper-icon-item>
          <paper-icon-item class="menu-icon-item" hidden$="[[isSignedIn]]">
            <iron-icon class="menu-icons" icon="icons:account-circle" item-icon></iron-icon>
            <a id="signin" href="/auth/signin">Sign-In</a>
          </paper-icon-item>
        </iron-selector>
      </app-drawer> 
      <!-- Header content -->
      <app-header-layout>
        <app-header id="appHeader" reveals>
          <app-toolbar id="appToolbar"> 
              <paper-icon-button id="appMenuIcon" class="activeLabel" icon="menu" on-tap="_drawerSelected"></paper-icon-button>
              <span id="appTitle" main-title>[[appTitle]]</span>
              <paper-tabs 
                id="tabscontainer" 
                selected="[[routeData.page]]" 
                attr-for-selected="id">
                <paper-tab id="trending" link>
                  <a href="/news/feed" class="link" tabindex="-1"></a>
                  <span class="tab-item-container">                
                    <iron-icon icon="icons:trending-up"></iron-icon>    
                    <div>MyStream</div>
                  </span> 
                </paper-tab>
                <paper-tab id="bumps" link>
                  <a href="/bumps/list" class="link" tabindex="-1"></a>
                  <span class="tab-item-container">                
                    <iron-icon icon="maps:terrain"></iron-icon>    
                    <div>BUMPS</div>
                  </span> 
                </paper-tab>
                <paper-tab id="solutions" link>
                  <a href="/solutions/list" tabindex="-1"></a>
                  <span class="tab-item-container">
                    <iron-icon icon="maps:near-me"></iron-icon>
                    <div>Solutions</div>
                  </span>
                </paper-tab>
                <paper-tab id="solvers" link>
                  <a href="/solvers/list" tabindex="-1"></a>
                  <span class="tab-item-container">
                    <iron-icon icon="icons:stars"></iron-icon>
                    <div>Solvers</div>
                  </span>
                </paper-tab>
              </paper-tabs>
              <div id="authicons" >
                <template is="dom-if" if="[[isSignedOut]]">
                  <a href="/auth/signin">
                    <iron-icon id="signInIcon" icon="icons:account-circle" ></iron-icon>
                  </a>
                </template>
                <template is="dom-if" if="[[isSignedIn]]">
                  <a href="/signout">
                    <iron-icon id="signOutIcon" icon="icons:account-circle"></iron-icon>
                  </a>
                </template>
                <template is="dom-if" if="[[isPending]]">
                  <paper-spinner-lite id="pending" class="white" active></paper-spinner-lite>
                </template>
              </div>
         </app-toolbar>
        </app-header>
          <iron-pages 
            id="pageSelector" 
            attr-for-selected="id" 
            selected="[[routeData.page]]" 
            fallback-selection="pathWarning">
            <auth-container id="auth"></auth-container>
            <signout-page id="signout"></signout-page>
            <bumps-container id="bumps"></bumps-container>
            <solvers-container id="solvers"></solvers-container>
            <solutions-container id="solutions"></solutions-container>
            <p id="pathWarning">Sorry. We can't find that page. :-(</p>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>
    <!-- Top Level Paging -->

  </template>
  <script>
    Polymer({
      is: 'ui-app',
      behaviors: [ReduxBehavior],
      // Redux Actions
      actions: {
         signOut: app.auth.signOut,
      },
      properties: {
        routeData: {
          type: String,
          reflectToAttribute: true,
        },
        displayName: {
          type: String,
          statePath: app.auth.getDisplayName,
        },
        appTitle: {
          type: String,
          value: document.title,
        },
        isSignedIn: {
          type: Boolean,
          statePath: app.auth.isSignedIn,
          observer: "_isSignedIn",
        },
        isSignedOut: {
          type: Boolean,
          statePath: app.auth.isSignedOut,
          observer: "_isSignedOut",
        },
        isPending: {
          type: Boolean,
          statePath: app.auth.isPending,
        },
       },
      attached: function() {
          this.set('route.path', '/bumps/list');
      },
      //Event listeners
      listeners: {
        'signout-confirmed' : '_signOutConfirmed', //from sign-out
        'signout-cancelled' : '_signOutCancelled', //from sign-out
      },
      //listener handlers
      _signOutConfirmed: function() {
        return this.dispatch('signOut');
      },
      _signOutCancelled: function () {
        this.set('route.path', '/bumps/list');
      },
      //Property Observers
      _isSignedIn: function () {
          if(this.isSignedIn) {
            this.set('route.path', '/bumps/list');
          }
      },
      _isSignedOut: function () {
          if(this.isSignedOut) {
            this.set('route.path', '/bumps/list');
          }
      },
      //supporting methods
      _drawerSelected: function() {
        if (!this.$.drawer.persistent) {
          this.$.drawer.toggle();
        }
      },
    });
  </script>
</dom-module>
