<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./redux-mixin.html">
<link rel="import" href="./auth/auth-error.html">
<link rel="import" href="./auth/auth-pending.html">
<link rel="import" href="./auth/auth-sign-in.html">
<link rel="import" href="./auth/auth-sign-out.html">
<link rel="import" href="./bump/bump-list.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-label/iron-label.html">
<link rel="import" href="./app-styles.html">

<dom-module id="ui-app">
  <template>
    <style include="app-styles">
        #app_header {
          background-color : var(--default-primary-color);
          color: var(--text-primary-color);
        }
        #logout_option:hover { 
          color: var(--accent-color);
          cursor: pointer;
        }
    </style>
    <app-header-layout>
        <app-header id="app_header" reveals effects="waterfall">
          <app-toolbar id="app_toolbar"> 
             <paper-icon-button id="app_menu_icon" icon="menu"></paper-icon-button>
             <div id="app_title" main-title>BUMPScout</div>
             <template is="dom-if" if="[[isSignedIn]]">
                <p id="user_name">hi, [[displayName]]</p>
                <span><p>&nbsp&nbsp|&nbsp&nbsp</p></span>
                <span>
                  <iron-label id="logout_option" on-tap="_signOut">Logout</iron-label>
                 </span> 
             </template>
          </app-toolbar>
        </app-header>
    </app-header-layout>


    <template is="dom-if" if="[[hasError]]">
      <auth-error
        id="error"
        message="[[errorText]]"
      >
      </auth-error>
    </template>
    <template is="dom-if" if="[[isPending]]">
      <auth-pending
        id="pending"
      >
      </auth-pending>
    </template>
    <template is="dom-if" if="[[isSignedIn]]">
      <auth-sign-out
        id="signOut"
        name="[[displayName]]"
        on-sign-out="_signOut"
      >
      </auth-sign-out>
      <bump-list
        id="list"
        bumps="[[bumps]]"
        on-add="_add"
      >
      </bump-list>
    </template>
    <template is="dom-if" if="[[isSignedOut]]">
      <auth-sign-in
        id="signIn"
        email="[[email]]"
        on-sign-in="_signIn"
        on-sign-in-with-google="_signInWithGoogle"
      >
      </auth-sign-in>
    </template>
  </template>
  <script>
    class UiApp extends ReduxMixin(Polymer.Element) {
      static get is() {
        return 'ui-app';
      }

      static get properties() {
        return {
          hasError: {
            type: Boolean,
            statePath: app.selectors.auth.hasError,
          },
          errorText: {
            type: String,
            statePath: app.selectors.auth.errorText,
          },
          isPending: {
            type: Boolean,
            statePath: app.selectors.auth.isPending,
          },
          isSignedIn: {
            type: Boolean,
            statePath: app.selectors.auth.isSignedIn,
          },
          displayName: {
            type: String,
            statePath: app.selectors.auth.displayName,
          },
          isSignedOut: {
            type: Boolean,
            statePath: app.selectors.auth.isSignedOut,
          },
          email: {
            type: String,
            statePath: app.selectors.auth.email,
          },
          bumps: {
            type: Array,
            statePath: app.selectors.bumps.list,
          },
        };
      }

      static get actions() {
        return {
          signInWithGoogle: app.actions.auth.signInWithGoogle,
          signInWithEmailAndPassword: app.actions.auth.signInWithEmailAndPassword,
          signOut: app.actions.auth.signOut,
          add: app.actions.bumps.add,
        };
      }

      _signInWithGoogle() {
        return this.dispatch(
          'signInWithGoogle'
        );
      }

      _signIn(event) {
        return this.dispatch(
          'signInWithEmailAndPassword',
          event.detail.email,
          event.detail.password
        );
      }

      _signOut() {
        return this.dispatch('signOut');
      }

      _add(event) {
        return this.dispatch(
          'add',
          event.detail.id,
          event.detail.name
        );
      }
    }

    customElements.define(UiApp.is, UiApp);
  </script>
</dom-module>
