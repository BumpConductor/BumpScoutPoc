<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./redux-behavior.html">
<link rel="import" href="./auth/auth-error.html">
<link rel="import" href="./auth/auth-pending.html">
<link rel="import" href="./auth/auth-sign-in.html">
<link rel="import" href="./auth/auth-sign-out.html">
<link rel="import" href="./bump/bump-list.html">

<dom-module id="ui-app">
  <template>
    <template is="dom-if" if="[[hasError]]">
      <auth-error
        id="error"
        message="[[errorText]]"
      >
      </auth-error>
    </template>
    <template is="dom-if" if="[[isPending]]">
      <auth-pending
        id="pending"
      >
      </auth-pending>
    </template>
    <template is="dom-if" if="[[isSignedIn]]">
      <auth-sign-out
        id="signOut"
        name="[[displayName]]"
        on-sign-out="_signOut"
      >
      </auth-sign-out>
      <bump-list
        id="list"
        bumps="[[bumps]]"
        on-add="_add"
      >
      </bump-list>
    </template>
    <template is="dom-if" if="[[isSignedOut]]">
      <auth-sign-in
        id="signIn"
        email="[[email]]"
        on-sign-in="_signIn"
        on-sign-in-with-google="_signInWithGoogle"
      >
      </auth-sign-in>
    </template>
  </template>
  <script>
    Polymer({
      is: 'ui-app',
      behaviors: [ReduxBehavior],
      properties: {
        hasError: {
          type: Boolean,
          statePath: app.selectors.auth.hasError,
        },
        errorText: {
          type: String,
          statePath: app.selectors.auth.errorText,
        },
        isPending: {
          type: Boolean,
          statePath: app.selectors.auth.isPending,
        },
        isSignedIn: {
          type: Boolean,
          statePath: app.selectors.auth.isSignedIn,
        },
        displayName: {
          type: String,
          statePath: app.selectors.auth.displayName,
        },
        isSignedOut: {
          type: Boolean,
          statePath: app.selectors.auth.isSignedOut,
        },
        email: {
          type: String,
          statePath: app.selectors.auth.email,
        },
        bumps: {
          type: Array,
          statePath: app.selectors.bumps.list,
        },
      },
      actions: {
        signInWithGoogle: app.actions.auth.signInWithGoogle,
        signInWithEmailAndPassword: app.actions.auth.signInWithEmailAndPassword,
        signOut: app.actions.auth.signOut,
        add: app.actions.bumps.add,
      },
      _signInWithGoogle: function() {
        return this.dispatch(
          'signInWithGoogle'
        );
      },
      _signIn: function(event) {
        return this.dispatch(
          'signInWithEmailAndPassword',
          event.detail.email,
          event.detail.password
        );
      },
      _signOut: function() {
        return this.dispatch('signOut');
      },
      _add: function(event) {
        return this.dispatch(
          'add',
          event.detail.id,
          event.detail.name
        );
      },
    });
  </script>
</dom-module>
