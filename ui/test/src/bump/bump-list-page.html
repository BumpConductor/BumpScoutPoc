<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <script src="../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="../../helpers/common.html">
    <link rel="import" href="../../../src/bump/bump-list-page.html">
  </head>
  <body>

  <test-fixture id="default">
     <template is="dom-template">
        <bump-list-page bumps="[[bumps]]"></bump-list-page>
      </template>
   </test-fixture>
   <test-fixture id="whenSignedOut">
      <template>
        <bump-list-page is-signed-out=false></bump-list-page>
      </template>
   </test-fixture> 
   <test-fixture id="whenSignedIn">
      <template>
        <bump-list-page is-signed-in=true></bump-list-page>
      </template>
   </test-fixture>    

  <script>
  var bumpList
  describe('bump-list-page', function(){
    describe('under default conditions', function(){
      beforeEach(function(done) {
        bumpList = fixture('default', {
          bumps: [{
            id: 1,
            name: 'bump 1',
          }, {
            id: 2,
            name: 'bump 2',
          }, {
            id: 3,
            name: 'bump 3',
          }]
        });
        flush(done);
      });
      it('should contain an addBump button', function() {
          expect(bumpList.$.addBumpBtn).to.be.ok;
      });
      it('should display the bumps', function() {
          bumpList.$$('#bump1').heading.should.eql('bump 1');
          bumpList.$$('#bump2').heading.should.eql('bump 2');
          bumpList.$$('#bump3').heading.should.eql('bump 3');
      });
      it('should contain a closed sign-in Digalog', function() {
          expect(bumpList.$.signInDialog).to.be.ok;
          expect(bumpList.$.signInBtn).to.be.ok;
          expect(bumpList.$.cancelBtn).to.be.ok;
          expect(bumpList.$.signInDialog.opened).to.be.false;
      });
    });
    describe('when signed-out', function(){
      before(function(done) {
        bumpList = fixture('whenSignedOut');
        flush(done);
      });
      describe('when the add button is clicked', function() {
         it('should display a signInDialog', function() {
           bumpList.$.addBumpBtn.click();
           expect(bumpList.$.signInDialog.opened).to.be.true;
         });
      });
    });
    describe('when signInDialog displayed', function(){
      beforeEach(function(done) {
        bumpList = fixture('whenSignedOut');
        bumpList.$.addBumpBtn.click();
        flush(done);
      });
      describe('when the dialog sign-in button is clicked', function() {
         it('should fire a request-signin event', function(done) {
           bumpList.addEventListener('request-signin', function(event) {
              done();
           });
           bumpList.$.signInBtn.click();
         });
      });
      describe('when the dialog cancel button is clicked', function() {
         it('should close the dialog', function(done) {
           bumpList.$.cancelBtn.click();
           expect(bumpList.$.signInDialog.opened).to.be.false;
           done();
         });
      });
    });
    describe('when signed-in', function(){
      before(function(done) {
        bumpList = fixture('whenSignedIn');
        flush(done);
      });
      describe('when the add button is clicked', function() {
          it('should fire a request-addbump-form event', function(done) {
            bumpList.addEventListener('request-addbump-form', function(event) {
              expect(bumpList.$.signInDialog.opened).to.be.false;
              done();
            });
            bumpList.$.addBumpBtn.click();
          });
      });
    });  
  });
    </script>
  </body>
</html>
